{% extends 'base.html' %}
{% load widget_tweaks %}
{% load custom_filters %}

{% block title %}Loan Application - BNK Services{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Loan Application Form</h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.full_name.id_for_label }}" class="form-label">Full Name</label>
                            {% render_field form.full_name class="form-control" %}
                            {% if form.full_name.errors %}
                            <div class="invalid-feedback d-block">{{ form.full_name.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.dob.id_for_label }}" class="form-label">Date of Birth</label>
                            {% render_field form.dob class="form-control" type="date" %}
                            {% if form.dob.errors %}
                            <div class="invalid-feedback d-block">{{ form.dob.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.contact_number.id_for_label }}" class="form-label">Contact Number</label>
                            {% render_field form.contact_number class="form-control" %}
                            {% if form.contact_number.errors %}
                            <div class="invalid-feedback d-block">{{ form.contact_number.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.email.id_for_label }}" class="form-label">Email</label>
                            {% render_field form.email class="form-control" %}
                            {% if form.email.errors %}
                            <div class="invalid-feedback d-block">{{ form.email.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.pan_card.id_for_label }}" class="form-label">PAN Card Number</label>
                            {% render_field form.pan_card class="form-control" %}
                            {% if form.pan_card.errors %}
                            <div class="invalid-feedback d-block">{{ form.pan_card.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.aadhar_number.id_for_label }}" class="form-label">Aadhar Number</label>
                            {% render_field form.aadhar_number class="form-control" %}
                            {% if form.aadhar_number.errors %}
                            <div class="invalid-feedback d-block">{{ form.aadhar_number.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.address.id_for_label }}" class="form-label">Address</label>
                        {% render_field form.address class="form-control" %}
                        {% if form.address.errors %}
                        <div class="invalid-feedback d-block">{{ form.address.errors|join:" " }}</div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.income_source.id_for_label }}" class="form-label">Income Source</label>
                            {% render_field form.income_source class="form-control" %}
                            {% if form.income_source.errors %}
                            <div class="invalid-feedback d-block">{{ form.income_source.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.monthly_income.id_for_label }}" class="form-label">Monthly Income</label>
                            {% render_field form.monthly_income class="form-control" %}
                            {% if form.monthly_income.errors %}
                            <div class="invalid-feedback d-block">{{ form.monthly_income.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.loan_type.id_for_label }}" class="form-label">Loan Type</label>
                            {% render_field form.loan_type class="form-control" %}
                            {% if form.loan_type.errors %}
                            <div class="invalid-feedback d-block">{{ form.loan_type.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.loan_amount.id_for_label }}" class="form-label">Loan Amount</label>
                            {% render_field form.loan_amount class="form-control" %}
                            {% if form.loan_amount.errors %}
                            <div class="invalid-feedback d-block">{{ form.loan_amount.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="{{ form.loan_tenure.id_for_label }}" class="form-label">Loan Tenure (months)</label>
                            {% render_field form.loan_tenure class="form-control" %}
                            {% if form.loan_tenure.errors %}
                            <div class="invalid-feedback d-block">{{ form.loan_tenure.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.purpose.id_for_label }}" class="form-label">Loan Purpose</label>
                        {% render_field form.purpose class="form-control" %}
                        {% if form.purpose.errors %}
                        <div class="invalid-feedback d-block">{{ form.purpose.errors|join:" " }}</div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.dsa_code.id_for_label }}" class="form-label">DSA Code</label>
                            {% render_field form.dsa_code class="form-control" %}
                            {% if form.dsa_code.errors %}
                            <div class="invalid-feedback d-block">{{ form.dsa_code.errors|join:" " }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.documents.id_for_label }}" class="form-label">Documents</label>
                            {% render_field form.documents class="form-control" %}
                            {% if form.documents.value %}
                            <div class="form-text">Current file: {{ form.documents.value|filename }}</div>
                            {% endif %}
                            {% if form.documents.errors %}
                            <div class="invalid-feedback d-block">{{ form.documents.errors|join:" " }}</div>
                            {% endif %}
                            <div class="form-text">Upload all required documents in a single PDF file.</div>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary">Submit Application</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add date picker for DOB field
    document.addEventListener('DOMContentLoaded', function() {
        const dobInput = document.querySelector('#{{ form.dob.id_for_label }}');
        if (dobInput) {
            dobInput.type = 'date';
            const maxDate = new Date();
            maxDate.setFullYear(maxDate.getFullYear() - 18); // Must be at least 18 years old
            dobInput.max = maxDate.toISOString().split('T')[0];
        }
    });
</script>
{% endblock %}